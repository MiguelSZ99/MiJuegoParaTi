<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Panel de Miguel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body style="font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
             background: #111; color: #fff; padding: 24px;">

  <h1>Panel de Miguel Ãngel ğŸ˜</h1>
  <p style="opacity:0.8;">
    AquÃ­ ves lo que ella escribiÃ³ y mandas tu respuesta real.
  </p>

  <div id="chatBox" style="margin-top:16px;"></div>

  <form method="post" action="{{ post_url }}" style="margin-top:18px;">
    <label for="respuesta" style="display:block; margin-bottom:6px;">
      Tu mensaje (Miguel Ãngel):
    </label>
    <textarea id="respuesta" name="respuesta"
      style="width:100%; max-width:480px; min-height:80px;
             border-radius:10px; padding:10px; border:none;"></textarea>
    <div style="margin-top:10px;">
      <button type="submit"
        style="border:none; border-radius:999px; padding:10px 18px; font-weight:600;
               background:#ff9bd2; color:#2a1430; cursor:pointer;">
        Enviar respuesta ğŸ’Œ
      </button>
    </div>
  </form>

  <p style="margin-top:24px; font-size:0.85rem; opacity:0.7;">
    Este panel es solo para ti. Ella solo ve la app del otro link.
  </p>

<script>
function updatePanel() {
    fetch("{{ estado_url }}")
    .then(r => r.json())
    .then(data => {
        const chatBox = document.getElementById("chatBox");
        chatBox.innerHTML = "";

        if (!data.historial || data.historial.length === 0) {
            const info = document.createElement("div");
            info.textContent = "AÃºn no hay mensajes en este chat ğŸ˜…";
            chatBox.appendChild(info);
            return;
        }

        data.historial.forEach(msg => {
            const div = document.createElement("div");
            div.style.marginTop = "8px";
            div.style.padding = "10px 12px";
            div.style.borderRadius = "10px";
            div.style.background = "#222";

            const tag = document.createElement("div");
            tag.style.fontSize = "0.75rem";
            tag.style.textTransform = "uppercase";
            tag.style.opacity = "0.7";

            const text = document.createElement("div");
            text.style.marginTop = "4px";
            text.textContent = msg.texto;

            if (msg.de === "ella") {
                tag.textContent = "Mensaje de ella â¤ï¸";
            } else if (msg.de === "miguel") {
                tag.textContent = "TÃº (Miguel Ãngel) ğŸ˜";
                div.style.background = "#233";
            } else {
                tag.textContent = "Mensaje";
            }

            div.appendChild(tag);
            div.appendChild(text);
            chatBox.appendChild(div);
        });
    }).catch(() => {});
}

setInterval(updatePanel, 2000);
updatePanel();
</script>

</body>
</html>
